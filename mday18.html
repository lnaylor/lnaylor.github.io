<!DOCTYPE html>
<html>

<head>
<title> Happy Mother's Day! </title>

</head>

<body onload="startGame()"
	background='lemon'>
<script type="text/javascript">

var pWidth = 400;
var pHeight = 20;

var oWidth = 200;
var oHeight = 10;

var offset = 10;
var a = 300;
var b = 50;
var token;
var my_attacks;
var p1;
var p2;
var w = 70;
var ground = 525;
var lettersList = ['H', 'A', 'P', 'P', 'Y', 'M', 'O', 'T', 'H', 'E', 'R', '\'', 'S', 'D', 'A', 'Y', '!'];
var typeList = ["Fire", "Water", "Electric", "Grass", "Ice", "Fighting", "Poison", "Ground", "Flying", "Psychic", "Bug", "Rock", "Ghost", "Dragon", "Dark", "Steel", "Fairy"];
var letters = [];
var j = [];
var uncovered = [];
var color = "purple";
var obsColor = "red";
var letterHeight = 100;
var pxList = [50, 450];
var pyList = [425, 230];
//var pList;
var oxList = [0, 300];
var oyList = [300, 75];
//var oList;
var nextPosition;
var tokenSpeed = 5;


function startGame() {
	token = new component(20, 20, color, 10, ground-30);
	my_attacks = new charge();
//	p1 = new platform(pxList[0], pyList[0]);
//	p2 = new platform(pxList[1], pyList[1]);
//	o1 = new obstacle(oxList[0], oyList[0]);
//	o2 = new obstacle(oxList[1], oyList[1]);
//	pList = [p1, p2];
//	oList = [o1, o2];
	for (k=0; k<lettersList.length; k++) {
		j.push(k);
	}
	for (l in lettersList) {
		var r = Math.floor(Math.random() * (j.length));
		letters.push(new letter(lettersList[l], j[r], typeList[l]));
		j.splice(r, 1);	
	}	
	nextPosition = 0;
	myGameArea.start();
}

var myGameArea = {
	canvas : document.createElement("canvas"),
	start : function() {
		this.canvas.width = window.innerWidth-20;
		this.canvas.height= window.innerHeight-20;
		this.context = this.canvas.getContext("2d");
		document.body.insertBefore(this.canvas, document.body.childNodes[0]);
		this.interval = setInterval(updateGameArea, 20);
	},
	clear : function() {
		this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
	}
	
}
document.addEventListener("keypress", jump);
document.addEventListener("keydown", changeSpeed);
document.addEventListener("keydown", dropCharge);
window.addEventListener("keydown", sideways);
window.addEventListener("keyup", stop);


function charge() {
	this.poke_type = null;
	this.color = null;
	this.charged = false;
	this.pending_charge = false;

	this.get_charge = function(poke_type, color) {
		this.pending_charge = true;
		this.poke_type = poke_type;
		this.color = color;
	}
	this.use_charge = function() {
		this.charged = false;
	}

	this.update = function() {
		if (this.pending_charge || this.charged) {
			
			ctx = myGameArea.context;
			ctx.font = "30pt Arial";
			ctx.fillStyle = this.color;
			ctx.fillText(this.poke_type, 20, ctx.canvas.height - letterHeight);
		}
	}
}

function measureText(text, font, size) {
	var str = text + ':' + font + ':' + size;
	if (typeof(_measuretext_cache__) == 'object' && __measuretext_cache__[str]) {
		return __measuretext_cache__[str];
	}

	var div = document.createElement('DIV');
		div.innerHTML = text;
		div.style.position = 'absolute';
		div.style.top = '-100px';
		div.style.left = '-100px';
		div.style.fontFamily = font;
		div.style.fontWeight = 'normal';
		div.style.fontSize = size + 'pt';
	document.body.appendChild(div);

	var size = [div.offsetWidth, div.offsetHeight];

	document.body.removeChild(div);
	
	if (typeof(__measurement_cache__) != 'object') {
		__measuretext_cache__ = [];
	}
	__measuretext_cache__[str] = size;
	
	return size;
}


function letter(lett, position, Poketype) {
	this.visible = true;
	this.lett = lett;
	this.position = position;
	this.lettHeight = a;
	this.Poketype = Poketype;
	this.box = true;
	switch(Poketype) {
		case "Fire":
			this.color = "red";
			break;
		case "Water":
			this.color = "blue";
			break;
		case "Electric":
			this.color = "yellow";
			break;
		case "Grass":
			this.color = "green";
			break;
		case "Ice":
			this.color = "aquamarine";
			break;
		case "Fighting":
			this.color = "brown";
			break;
		case "Poison":
			this.color = "purple";
			break;
		case "Ground":
			this.color = "tan";
			break;
		case "Flying":
			this.color = "MediumPurple";
			break;
		case "Psychic":
			this.color = "DeepPink";
			break;
		case "Bug":
			this.color = "YellowGreen";
			break;
		case "Rock":
			this.color = "Tan";
			break;
		case "Ghost":
			this.color = "SlateBlue";
			break;
		case "Dragon":
			this.color = "Indigo";
			break;
		case "Dark":
			this.color = "black";
			break;
		case "Steel":
			this.color = "grey";
			break;
		case "Fairy":
			this.color = "Orchid";
			break;
		default:
			this.color = "black";
	}
	this.update = function() {
		ctx = myGameArea.context;
		ctx.font = "20pt Arial";
		this.height = measureText(this.lett, 'Arial', 20)[1];
		this.width = measureText(this.lett, 'Arial', 20)[0] +20;
		ctx.fillStyle = color; 
			
		if (this.visible) {
			ctx.beginPath();
			ctx.fillStyle="black";
			var ms = measureText(this.Poketype, 'Arial', 10);

			ctx.fillRect((this.position)*(w)-3, this.lettHeight-50-ms[1], ms[0]+6, ms[1]+5);
			ctx.stroke();
			ctx.font = "20pt Arial";
			ctx.fillStyle = color; 
			ctx.fillText(this.lett, (this.position)*(w)+offset, this.lettHeight);
			ctx.font = "10pt Arial";
			ctx.fillStyle = "white";
			ctx.fillText(this.Poketype, (this.position)*(w), this.lettHeight-50);
			ctx.beginPath();
			if (this.box==true) {
				ctx.lineWidth = "2";
				ctx.strokeStyle=this.color;
				ctx.rect(this.position*w, this.lettHeight-25, this.width, this.height);
				ctx.stroke();	
			}
		}
	}
}

function platform(xPos, yPos) {
		this.xPos = xPos;
		this.yPos = yPos;
		this.speedX = 0;
		this.speedY = 0;
		this.movingRight = true;
		
		this.update = function() {
			ctx = myGameArea.context;
			if (this.movingRight) {
				if (this.xPos+pWidth < ctx.canvas.width) {
					this.speedX = 2.5;
				}
				else {
					this.movingRight = false;
				}
			}
			else {
				if (this.xPos > 0) {
					this.speedX = -2.5
				}
				else {
					this.movingRight = true;
				}
			}
			this.xPos += this.speedX;
			ctx.fillStyle = color;
			ctx.fillRect(this.xPos, this.yPos, pWidth, pHeight);
		}	
}

function obstacle(xPos, yPos) {
		this.xPos = xPos;
		this.yPos = yPos;
		this.movingRight = false;
		
		this.update = function() {
			ctx = myGameArea.context;
			if (this.movingRight) {
				if (this.xPos+oWidth < ctx.canvas.width) {
					this.xPos += 5;
				}
				else {
					this.movingRight = false;
				}
			}
			else {
				if (this.xPos > 0) {
					this.xPos -= 5;
				}
				else {
					this.movingRight = true;
				}
			}
			ctx.fillStyle = obsColor;
			ctx.fillRect(this.xPos, this.yPos, oWidth, oHeight);
		}	
}

function component(width, height, color, x, y) {
	this.width = width;
	this.height = height;
	this.x = x;
	this.y = y;
	this.speedX = 0;
	this.speedY = 0;
	this.movingSideways = false;
	this.jumping = false;
	this.onPlatform = false;
	this.onGround = true;
	this.d = new Date();
	this.update = function() {

		ctx = myGameArea.context;
		ctx.fillStyle = color;
		ctx.fillRect(this.x, this.y, this.width, this.height);
	}

	this.newSpeed = function() {
		if (this.onGround && my_attacks.pending_charge) {
			my_attacks.charged = true;
			my_attacks.pending_charge = false;
		}
		if (this.jumping) {
			this.onPlatform = false;
			this.onGround = false;
			currentTime = new Date();
			var t = (currentTime - this.d.getTime())/1000;
			this.speedY = 19*t-14;
		}	
		if ((this.y)+(this.height) > ground) {
			this.speedY = 0;
			this.y = ground-this.height;
			this.jumping = false;
			this.onGround = true;
		}
		if ((this.y) < 0) {
			this.speedY = -this.speedY;
			this.jumping = false;
		}
		if ((this.x) < 0) {
			this.speedX = 0;
			this.x = 0;
		}	
		if ((this.x)+(this.width) > myGameArea.context.canvas.width) {
			this.speedX = 0;
			this.x = myGameArea.context.canvas.width - this.width;
		}
//		for (i = 0; i < oList.length; i++) {
//			if ((this.x<oList[i].xPos+oWidth) && (this.x+this.width>oList[i].xPos) && (this.y<oList[i].yPos+oHeight) && (this.y+this.height>oList[i].yPos)) {
//				this.y = ground-this.height;
//				this.speedY = 0;
//				this.speedX = 0;
//				this.onPlatform = false;
//				this.movingSideways = false;
//				this.onGround = true;
//				this.jumping = false;
//			}
//		}
		var foundPlatform = false;
//		for (i = 0; i< pList.length; i++) {
//			if ((this.x < (pList[i].xPos+pWidth)) && (((this.x)+(this.width)) > pList[i].xPos) && (this.y+(this.height) > pList[i].yPos) && (this.y+(this.height) < (pList[i].yPos+pHeight))) {
//				this.onPlatform = true;
//				this.speedY = 0;
//				this.jumping = false;
//				this.y = pList[i].yPos-this.height;
//				foundPlatform = true;
//				if (!this.movingSideways) {
//					this.speedX = pList[i].speedX;
//				}
//			}
//			else {
//				this.onPlatform = false;
//			}
//			if ((this.x < (pList[i].xPos+pWidth)) && (((this.x)+(this.width)) > pList[i].xPos) && (this.y+(this.height) >= pList[i].yPos) && (this.y+(this.height) < (pList[i].yPos+pHeight))) {
//				foundPlatform = true;
//				this.onPlatform = true;
//				if (!this.movingSideways) {
//					this.speedX = pList[i].speedX;
//				}
//			}
//			if ((this.x < (pList[i].xPos+pWidth)) && (((this.x)+(this.width)) > pList[i].xPos) && (this.y <= pList[i].yPos+pHeight) && (this.y+this.height > pList[i].yPos+pHeight)) {
//				currentTime = new Date();
//				var t = (currentTime - this.d.getTime())/1000;
//				this.speedY = 3*t;
//				this.jumping = false;
//			}	
//		}
		if ((!this.onGround) && (!this.onPlatform) && (!this.jumping)  && (!foundPlatform)) {
			currentTime = new Date();
			var t = (currentTime - this.d.getTime())/1000;
			this.speedY = 3*t;
		}
	}
	this.newPos = function() {
		this.x += this.speedX;
		this.y += this.speedY;
	}
	this.hitLetter = function(lett) {
		var left1 = this.x;
		var right1 = this.x + (this.width);
		var top1 = this.y;
		var bottom1 = this.y + (this.height);
//	ctx.rect(this.position*w, this.lettHeight-25, this.width, this.height);
		var left2 = lett.position*(w);
		var right2 = left2 + (lett.width);
		var top2 = lett.lettHeight-25;
		var bottom2 = top2 + lett.height;
//		ctx = myGameArea.context;
//		ctx.rect(left2, top2, right2-left2, bottom2-top2);
//		ctx.stroke();
		if (((bottom1 > top2) && (top1<bottom2) && (left1 < right2) && (right1 > left2))) {
			if (lett.lett == lettersList[nextPosition] && lett.visible) {
				if (!lett.box) {
					lett.visible = false;
					nextPosition += 1;
				}
			}
			if (lett.box && !my_attacks.charged) {
				my_attacks.get_charge(lett.Poketype, lett.color);
				console.log(my_attacks.poke_type, my_attacks.color);
			}
			if (my_attacks.charged) {
				switch(my_attacks.poke_type) {
					case "Fire":
							if (lett.box && (lett.Poketype=="Grass" || lett.Poketype=="Ice" || lett.Poketype=="Bug" || lett.Poketype=="Steel")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Water":
							if (lett.box && (lett.Poketype=="Fire" || lett.Poketype=="Ground" || lett.Poketype=="Rock")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Electric":
							if (lett.box && (lett.Poketype=="Water" || lett.Poketype=="Flying")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Grass":
							if (lett.box && (lett.Poketype=="Water" || lett.Poketype=="Ground" || lett.Poketype=="Rock")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Ice":
							if (lett.box && (lett.Poketype=="Grass" || lett.Poketype=="Ground" || lett.Poketype=="Flying" || lett.Poketype=="Dragon")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Fighting":
							if (lett.box && (lett.Poketype=="Ice" || lett.Poketype=="Rock" || lett.Poketype=="Dark" || lett.Poketype=="Steel")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Poison":
							if (lett.box && (lett.Poketype=="Grass" || lett.Poketype=="Fairy")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Ground":
							if (lett.box && (lett.Poketype=="Fire" || lett.Poketype=="Electric" || lett.Poketype=="Poison" || lett.Poketype=="Rock" || lett.Poketype=="Steel")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Flying":
							if (lett.box && (lett.Poketype=="Grass" || lett.Poketype=="Fighting" || lett.Poketype=="Bug")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Psychic":
							if (lett.box && (lett.Poketype=="Fighting" || lett.Poketype=="Poison")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Bug":
							if (lett.box && (lett.Poketype=="Grass" || lett.Poketype=="Psychic" || lett.Poketype=="Dark")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Rock":
							if (lett.box && (lett.Poketype=="Fire" || lett.Poketype=="Ice" || lett.Poketype=="Flying" || lett.Poketype=="Bug")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Ghost":
							if (lett.box && (lett.Poketype=="Psychic" || lett.Poketype=="Ghost")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Dragon":
							if (lett.box && (lett.Poketype=="Dragon")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Dark":
							if (lett.box && (lett.Poketype=="Psychic" || lett.Poketype=="Ghost")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Steel":
							if (lett.box && (lett.Poketype=="Ice" || lett.Poketype=="Rock" || lett.Poketype=="Fairy")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
					case "Fairy":
							if (lett.box && (lett.Poketype=="Fighting" || lett.Poketype=="Dragon" || lett.Poketype=="Dark")) {
								lett.box = false;
								my_attacks.use_charge();
							}
						break;
				}
			}
		}
	}
}


function updateGameArea() {
	myGameArea.clear();
	token.newSpeed();
	token.newPos();
	token.update();
	my_attacks.update();
//	p1.update();
//	p2.update();
//	o1.update();
//	o2.update();
	for (i = 0; i< letters.length; i++) {
		token.hitLetter(letters[i]);
		letters[i].update();
	}
	ctx = myGameArea.context;
	ctx.font = "30pt Arial";
	ctx.fillStyle = color;
	for (i = 0; i<nextPosition; i++) {
	ctx.fillText(lettersList[i], i*w, ctx.canvas.height);
	}
}

function jump(event) {
	if (event.keyCode == 32 && token.jumping==false) {
		token.jumping = true;	
		token.d = new Date();
		console.log("JUMPING");
	}
}

function changeSpeed(event) {
	if (event.keyCode == 38) {
		tokenSpeed+=1;
	}
	else if (event.keyCode==40 && tokenSpeed>1) {
		tokenSpeed-=1;
	}
}

function dropCharge(event) {
	if (event.keyCode == 82) {
		my_attacks.use_charge();
	}
}

function sideways(event) {
	if ((event.keyCode == 65 || event.keyCode == 37)) {
//	if ((token.jumping==false) && (event.keyCode == 65 || event.keyCode == 37)) {
		token.movingSideways = true;
		token.speedX = -1*tokenSpeed;
	}
	if ((event.keyCode == 68 || event.keyCode == 39)) {
//	if ((token.jumping==false) && (event.keyCode == 68 || event.keyCode == 39)) {
		token.movingSideways = true;
		token.speedX = tokenSpeed;
	}
}

function stop(event) {
	if (event.keyCode == 68 || event.keyCode == 39 || event.keyCode == 65 || event.keyCode == 37) {
		token.speedX =0;
		token.movingSideways = false;
	}
}




</script>


</body>

</html>
